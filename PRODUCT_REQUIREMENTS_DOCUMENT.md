# 心率识别系统产品需求文档

## 1. 产品概览

本产品是一款基于远程光电容积描记术(rPPG)的非接触式心率检测系统，通过普通摄像头实时监测用户心率，无需传感器与人体接触。

### 核心价值
- **非接触式监测**：无需佩戴任何设备，通过普通摄像头即可监测心率
- **实时反馈**：提供实时心率数据和信号质量分析
- **环境适应性**：在不同光照条件下保持稳定性能
- **用户友好**：简洁直观的用户界面，易于使用

### 目标用户
- **普通用户**：关注健康状况，需要日常心率监测
- **健身爱好者**：在运动前后监测心率变化
- **医疗专业人士**：需要在无接触场景下监测患者心率
- **远程健康监测服务提供商**：为客户提供远程心率监测解决方案

### 应用场景
- **家庭健康监测**：日常心率监测和健康状况评估
- **远程医疗咨询**：在线问诊时的生命体征监测
- **健身中心**：运动过程中的心率监测
- **办公环境**：长时间工作时的健康提醒
- **公共场所**：人群健康状况监测（如疫情期间）

## 2. 核心功能

### 2.1 功能模块

我们的心率识别系统包含以下核心页面和功能模块：

1. **主页面**
   - 视频显示区域
   - 心率实时显示
   - 信号质量监测
   - 系统状态指示
   - 控制按钮（开始/停止/保存）

2. **历史记录页面**
   - 历史心率数据列表
   - 数据统计分析
   - 导出功能

3. **设置页面**
   - 摄像头选择
   - 分辨率设置
   - 系统参数调整

### 2.2 页面详情

| 页面名称 | 模块名称 | 功能描述 |
|---------|---------|----------|
| 主页面 | 视频显示 | 显示摄像头实时视频流，提供视觉反馈 |
| 主页面 | 心率显示 | 实时显示当前心率值，更新频率1次/秒 |
| 主页面 | 信号质量 | 显示当前信号质量指标，帮助用户调整位置 |
| 主页面 | 系统状态 | 显示系统连接状态、处理状态等信息 |
| 主页面 | 控制按钮 | 提供开始/停止监测、保存当前数据等操作 |
| 主页面 | 信号图表 | 实时显示PPG信号波形，帮助用户了解信号质量 |
| 历史记录页 | 数据列表 | 显示历史心率记录，包含时间和心率值 |
| 历史记录页 | 数据统计 | 显示平均心率、最高心率、最低心率等统计数据 |
| 历史记录页 | 导出功能 | 支持将历史数据导出为CSV或PDF格式 |
| 设置页面 | 摄像头设置 | 选择使用的摄像头设备和分辨率 |
| 设置页面 | 系统参数 | 调整系统敏感度、滤波参数等高级设置 |
| 设置页面 | 外观设置 | 调整界面主题、颜色等视觉设置 |

## 3. 核心流程

### 用户操作流程

1. **启动系统**
   - 用户打开应用网页
   - 系统请求摄像头权限
   - 用户授权摄像头访问

2. **开始监测**
   - 用户点击"开始"按钮
   - 系统开始面部检测
   - 系统提取皮肤区域
   - 系统开始信号处理和心率计算
   - 界面显示实时心率和信号质量

3. **监测过程**
   - 系统持续分析视频流
   - 实时更新心率数据
   - 显示信号质量指标
   - 用户可根据信号质量调整位置

4. **停止监测**
   - 用户点击"停止"按钮
   - 系统停止分析
   - 显示最终心率数据

5. **保存数据**
   - 用户点击"保存"按钮
   - 系统记录当前心率数据
   - 数据添加到历史记录

6. **查看历史**
   - 用户点击"历史记录"按钮
   - 系统显示历史心率数据
   - 用户可查看统计分析

### 系统处理流程

1. **视频捕获**
   - 从摄像头获取视频帧
   - 帧预处理和格式转换

2. **面部检测**
   - 检测画面中的人脸
   - 计算人脸坐标和边界

3. **皮肤分割**
   - 使用深度学习模型分割皮肤像素
   - 应用光照补偿和对比度增强

4. **信号提取**
   - 从皮肤区域提取rPPG信号
   - 应用多ROI融合技术

5. **信号处理**
   - 信号滤波和去噪
   - 小波变换和卡尔曼滤波

6. **心率计算**
   - FFT频率分析
   - 峰值检测和心率估计

7. **数据传输**
   - 通过WebSocket传输数据到前端
   - 前端实时显示结果

## 4. 用户接口设计

### 4.1 设计风格

- **主色调**：蓝色 (#3498db) 和白色 (#ffffff)，传达医疗健康和专业感
- **辅助色**：绿色 (#2ecc71) 表示正常状态，红色 (#e74c3c) 表示异常状态
- **按钮样式**：圆角矩形，有轻微阴影，悬停效果
- **字体**：无衬线字体，清晰易读
- **布局**：响应式设计，适应不同屏幕尺寸
- **图标**：简约线条风格图标，保持视觉一致性

### 4.2 页面设计概览

| 页面名称 | 模块名称 | UI元素 |
|---------|---------|--------|
| 主页面 | 视频显示 | 居中大尺寸视频窗口，边框为圆角矩形，轻微阴影 |
| 主页面 | 心率显示 | 大号数字显示，字体清晰，颜色随心率范围变化 |
| 主页面 | 信号质量 | 圆形仪表盘，绿色表示良好，黄色表示一般，红色表示差 |
| 主页面 | 控制按钮 | 醒目的开始/停止按钮，保存按钮较小但易于点击 |
| 主页面 | 信号图表 | 实时更新的波形图表，使用Canvas绘制，红色线条模拟心电图 |
| 历史记录页 | 数据列表 | 表格形式，时间排序，包含日期、时间、心率值 |
| 历史记录页 | 数据统计 | 卡片式布局，显示平均、最高、最低心率等关键指标 |
| 设置页面 | 摄像头设置 | 下拉选择框，预览窗口 |
| 设置页面 | 系统参数 | 滑动条和数字输入框，提供默认值 |

### 4.3 自适应

- **桌面优先设计**：针对桌面电脑优化布局
- **移动设备适配**：响应式设计，在平板和手机上自动调整布局
- **触控友好**：在移动设备上增大按钮尺寸，优化触控体验
- **横竖屏适配**：自动适应设备横竖屏切换
- **低带宽优化**：在网络条件差时自动降低视频质量，保证核心功能正常

## 5. 功能需求（Functional Requirements）

| 编号 | 功能点 | 用户故事/缘由说明 | 输入/输出/流程 | 详细说明 | 优先级 |
|-----|-------|-----------------|--------------|----------|--------|
| FR1 | 摄像头访问 | 作为用户，我希望系统能够访问我的摄像头，以便进行心率监测 | 输入：用户授权<br>输出：摄像头实时视频流<br>流程：请求权限 → 用户授权 → 显示视频 | 1. 支持多个摄像头选择<br>2. 提供摄像头分辨率选项<br>3. 摄像头访问失败时提供错误提示 | P0 |
| FR2 | 面部检测 | 作为用户，我希望系统能够自动检测我的面部，以便正确定位监测区域 | 输入：视频帧<br>输出：面部坐标<br>流程：分析视频帧 → 检测人脸 → 标记位置 | 1. 支持多人脸检测<br>2. 适应不同角度和距离的人脸<br>3. 面部检测失败时提供提示 | P0 |
| FR3 | 皮肤分割 | 作为用户，我希望系统能够准确识别皮肤区域，以便提高监测准确性 | 输入：包含人脸的视频帧<br>输出：皮肤像素掩码<br>流程：分析图像 → 分割皮肤像素 → 应用掩码 | 1. 适应不同肤色<br>2. 不受背景干扰<br>3. 实时处理能力 | P0 |
| FR4 | 心率计算 | 作为用户，我希望系统能够计算我的实时心率，以便了解我的健康状况 | 输入：皮肤区域视频帧<br>输出：心率值（BPM）<br>流程：提取信号 → 处理信号 → 计算心率 | 1. 心率范围：40-200 BPM<br>2. 更新频率：1次/秒<br>3. 显示小数点后一位 | P0 |
| FR5 | 信号质量监测 | 作为用户，我希望系统能够显示信号质量，以便我调整位置获得最佳监测效果 | 输入：处理后的信号<br>输出：信号质量指标<br>流程：分析信号 → 计算质量指标 → 显示结果 | 1. 质量范围：0-100<br>2. 颜色编码：绿色(>70)，黄色(40-70)，红色(<40)<br>3. 提供调整建议 | P1 |
| FR6 | 环境光补偿 | 作为用户，我希望系统在不同光照条件下都能正常工作，以便在任何环境中使用 | 输入：视频帧和环境光数据<br>输出：补偿后的信号<br>流程：检测环境光 → 应用补偿算法 → 处理信号 | 1. 适应室内外光照变化<br>2. 自动调整参数<br>3. 在极端光照下提供提示 | P1 |
| FR7 | 运动补偿 | 作为用户，我希望系统对轻微头部运动有一定容忍度，以便我在监测时保持自然状态 | 输入：连续视频帧<br>输出：补偿后的信号<br>流程：检测运动 → 应用补偿算法 → 处理信号 | 1. 容忍轻微头部晃动<br>2. 运动过大时提供提示<br>3. 多ROI融合提高鲁棒性 | P1 |
| FR8 | 数据记录 | 作为用户，我希望系统能够保存我的心率数据，以便我查看历史记录 | 输入：心率数据和时间戳<br>输出：存储的数据<br>流程：用户点击保存 → 系统记录数据 → 数据添加到历史 | 1. 保存时间、心率值、信号质量<br>2. 本地存储，保护隐私<br>3. 支持批量导出 | P1 |
| FR9 | 历史数据查看 | 作为用户，我希望能够查看我的历史心率数据，以便了解我的健康趋势 | 输入：用户访问历史页面<br>输出：历史数据列表和统计<br>流程：加载历史数据 → 显示列表 → 计算统计指标 | 1. 按时间倒序排列<br>2. 显示日期、时间、心率值<br>3. 提供平均值、最大值、最小值统计 | P2 |
| FR10 | 数据导出 | 作为用户，我希望能够导出我的心率数据，以便与医疗专业人士分享或进一步分析 | 输入：用户点击导出按钮<br>输出：CSV或PDF文件<br>流程：用户选择格式 → 系统生成文件 → 下载文件 | 1. 支持CSV格式（便于数据分析）<br>2. 支持PDF格式（便于打印）<br>3. 导出包含完整数据和统计信息 | P2 |
| FR11 | 系统设置 | 作为用户，我希望能够调整系统参数，以便获得最佳监测效果 | 输入：用户设置参数<br>输出：更新的系统配置<br>流程：用户调整参数 → 系统保存设置 → 应用新设置 | 1. 摄像头选择<br>2. 分辨率设置<br>3. 高级信号处理参数调整 | P2 |
| FR12 | 多人监测 | 作为医疗专业人士，我希望系统能够同时监测多个人的心率，以便提高工作效率 | 输入：包含多个人的视频帧<br>输出：多个人的心率数据<br>流程：检测多个人脸 → 分别处理 → 显示多人数据 | 1. 支持2-4人同时监测<br>2. 为每个人分配唯一标识<br>3. 分别显示每个人的心率和信号质量 | P3 |

## 6. 非功能需求（Non-Functional Requirements）

| 编号 | 需求点 | 详细说明 | 测试方法 | 优先级 |
|-----|-------|----------|----------|--------|
| NFR1 | 实时性能 | 系统应在实时视频流上运行，每帧处理时间不超过400ms，心率显示延迟不超过1秒 | 1. 测量每帧处理时间<br>2. 测量从视频捕获到显示的端到端延迟<br>3. 在不同硬件配置上测试 | P0 |
| NFR2 | 准确性 | 系统在静态场景下的心率测量误差应小于±5 BPM，在轻微运动场景下误差应小于±8 BPM | 1. 与医疗级心率监测设备对比<br>2. 在不同场景下测试<br>3. 统计分析误差分布 | P0 |
| NFR3 | 稳定性 | 系统应能连续运行至少2小时而不崩溃，在网络波动时保持稳定 | 1. 长时间运行测试<br>2. 网络中断恢复测试<br>3. 资源泄漏检测 | P0 |
| NFR4 | 兼容性 | 系统应支持主流浏览器（Chrome、Firefox、Safari、Edge）和操作系统（Windows、macOS、Linux） | 1. 在不同浏览器中测试<br>2. 在不同操作系统中测试<br>3. 在不同版本的浏览器中测试 | P1 |
| NFR5 | 可用性 | 系统界面应直观易用，新用户无需培训即可上手使用 | 1. 用户体验测试<br>2. 任务完成时间测量<br>3. 用户满意度调查 | P1 |
| NFR6 | 安全性 | 系统应保护用户隐私，所有数据处理在本地完成，不上传个人信息 | 1. 网络流量分析<br>2. 数据存储位置检查<br>3. 隐私政策合规性审查 | P1 |
| NFR7 | 可扩展性 | 系统架构应支持未来功能扩展，如呼吸率检测、情绪分析等 | 1. 架构评审<br>2. 模块独立性检查<br>3. 接口设计审查 | P2 |
| NFR8 | 资源使用 | 系统应高效使用系统资源，CPU使用率不超过50%，内存使用不超过2GB | 1. 资源监控测试<br>2. 在不同硬件配置上测试<br>3. 长时间运行资源使用趋势分析 | P2 |
| NFR9 | 鲁棒性 | 系统应能处理各种异常情况，如摄像头断开、网络中断等，并有适当的错误处理 | 1. 异常场景测试<br>2. 错误处理有效性检查<br>3. 恢复能力测试 | P2 |
| NFR10 | 可维护性 | 系统代码应结构清晰，有完善的文档，便于维护和升级 | 1. 代码质量审查<br>2. 文档完整性检查<br>3. 测试覆盖率分析 | P3 |

## 7. 数据需求

### 7.1 数据类型

| 数据类型 | 描述 | 存储方式 | 优先级 |
|---------|------|----------|--------|
| 视频帧数据 | 从摄像头获取的原始视频帧 | 内存临时存储，不持久化 | P0 |
| 面部坐标 | 检测到的人脸位置坐标 | 内存临时存储，不持久化 | P0 |
| 皮肤掩码 | 分割得到的皮肤像素掩码 | 内存临时存储，不持久化 | P0 |
| rPPG信号 | 提取的原始和处理后的信号 | 内存临时存储，不持久化 | P0 |
| 心率数据 | 计算得到的心率值 | 本地存储（IndexedDB） | P0 |
| 信号质量 | 信号质量指标 | 本地存储（IndexedDB） | P1 |
| 系统设置 | 用户配置的系统参数 | 本地存储（LocalStorage） | P1 |
| 历史记录 | 保存的心率历史数据 | 本地存储（IndexedDB） | P1 |

### 7.2 数据存储

- **本地存储**：所有用户数据存储在浏览器本地，使用IndexedDB和LocalStorage
- **数据安全**：数据不传输到服务器，保护用户隐私
- **数据导出**：支持导出为CSV和PDF格式
- **数据清理**：用户可手动清理历史数据
- **存储限制**：考虑浏览器存储限制，实现数据管理策略

### 7.3 数据处理

- **实时处理**：视频帧和信号处理在本地实时完成
- **数据压缩**：视频帧传输前进行压缩
- **信号滤波**：应用多种滤波技术提高信号质量
- **数据验证**：验证心率数据的合理性，过滤异常值

## 8. 范围限定

### 8.1 功能范围

- **包含**：非接触式心率检测、实时数据显示、信号质量监测、历史数据记录
- **不包含**：血压监测、血氧饱和度监测、睡眠监测、ECG心电图

### 8.2 技术范围

- **包含**：基于摄像头的rPPG技术、深度学习皮肤分割、高级信号处理
- **不包含**：基于雷达的监测、基于音频的监测、基于红外的监测

### 8.3 性能范围

- **支持**：720p及以上分辨率摄像头、实时处理、多ROI融合
- **限制**：极端光照条件（如强阳光直射）、剧烈运动场景、多人同时监测（最多4人）

### 8.4 应用范围

- **适合**：家庭使用、远程医疗咨询、健身监测、办公健康提醒
- **不适合**：重症监护、专业医疗诊断、高精度心率变异性分析

## 9. 验收标准

### 9.1 功能验收

| 功能点 | 验收标准 | 测试方法 |
|-------|---------|----------|
| 摄像头访问 | 系统能够成功访问摄像头并显示实时视频流 | 手动测试不同浏览器和操作系统 |
| 面部检测 | 系统能够检测不同角度、距离的人脸 | 手动测试不同场景下的人脸检测 |
| 皮肤分割 | 系统能够准确分割不同肤色的皮肤区域 | 手动测试不同肤色的皮肤分割效果 |
| 心率计算 | 系统计算的心率与医疗级设备误差小于±5 BPM | 与医疗级心率监测设备对比测试 |
| 信号质量监测 | 系统能够正确显示信号质量并在质量差时提供提示 | 手动测试不同位置和角度的信号质量显示 |
| 环境光补偿 | 系统在不同光照条件下保持稳定性能 | 手动测试不同光照条件下的心率测量 |
| 数据记录 | 系统能够保存心率数据并在历史页面显示 | 手动测试数据保存和查看功能 |
| 历史数据查看 | 系统能够显示历史心率数据和统计信息 | 手动测试历史数据页面功能 |
| 数据导出 | 系统能够导出CSV和PDF格式的历史数据 | 手动测试导出功能并验证文件内容 |
| 系统设置 | 系统能够保存用户设置并在重启后保持 | 手动测试设置保存和加载功能 |

### 9.2 非功能验收

| 需求点 | 验收标准 | 测试方法 |
|-------|---------|----------|
| 实时性能 | 每帧处理时间小于400ms，心率显示延迟小于1秒 | 性能测试工具测量处理时间 |
| 准确性 | 静态场景误差小于±5 BPM，轻微运动场景误差小于±8 BPM | 与医疗级设备对比测试 |
| 稳定性 | 系统连续运行2小时无崩溃，网络波动后能自动恢复 | 长时间运行测试和网络中断测试 |
| 兼容性 | 系统在所有支持的浏览器和操作系统中正常运行 | 跨浏览器和跨平台测试 |
| 可用性 | 新用户能够在5分钟内完成基本操作 | 用户体验测试和任务完成时间测量 |
| 安全性 | 所有数据处理在本地完成，无数据上传 | 网络流量分析和数据存储检查 |
| 资源使用 | CPU使用率小于50%，内存使用小于2GB | 资源监控工具测量 |
| 鲁棒性 | 系统能够处理摄像头断开、网络中断等异常情况 | 异常场景测试 |

### 9.3 边界条件验收

| 边界条件 | 验收标准 | 测试方法 |
|---------|---------|----------|
| 低分辨率摄像头 | 系统能够在640x480分辨率下正常工作 | 使用低分辨率摄像头测试 |
| 极端光照 | 系统在强阳光和弱光条件下提供合理的错误提示 | 在极端光照条件下测试 |
| 多人场景 | 系统能够同时监测最多4个人的心率 | 多人同时测试 |
| 剧烈运动 | 系统在用户剧烈运动时提供合理的错误提示 | 运动场景测试 |
| 长时间使用 | 系统连续使用2小时后性能保持稳定 | 长时间运行测试 |

## 10. 风险/依赖备注

### 10.1 技术风险

| 风险 | 影响 | 缓解策略 |
|-----|------|----------|
| 皮肤分割准确性 | 影响心率测量准确性 | 1. 优化深度学习模型<br>2. 多ROI融合技术<br>3. 持续模型训练 |
| 环境光变化 | 影响信号质量和测量准确性 | 1. 环境光补偿算法<br>2. 自适应参数调整<br>3. 多光谱分析 |
| 运动干扰 | 影响信号质量和测量稳定性 | 1. 运动补偿算法<br>2. 多ROI融合<br>3. 卡尔曼滤波 |
| 不同肤色适应性 | 影响不同人群的测量准确性 | 1. 多样化训练数据<br>2. 肤色自适应算法<br>3. 多光谱分析 |
| 实时性能挑战 | 影响用户体验和实用性 | 1. 模型压缩技术<br>2. 多线程并行处理<br>3. 硬件加速 |

### 10.2 业务风险

| 风险 | 影响 | 缓解策略 |
|-----|------|----------|
| 用户期望管理 | 用户可能期望医疗级准确性 | 1. 明确产品定位和局限性<br>2. 提供准确性说明<br>3. 与医疗设备对比数据 |
| 市场竞争 | 市场上存在其他心率监测产品 | 1. 突出非接触式优势<br>2. 优化用户体验<br>3. 持续技术创新 |
| 监管合规 | 医疗相关产品可能需要监管认证 | 1. 明确产品定位为健康监测而非医疗诊断<br>2. 遵守相关数据隐私法规<br>3. 咨询法律专家 |

### 10.3 依赖项

| 依赖 | 影响 | 管理策略 |
|-----|------|----------|
| 浏览器兼容性 | 影响用户可访问性 | 1. 定期测试主流浏览器<br>2. 提供浏览器兼容性指南<br>3. 使用标准Web API |
| 硬件性能 | 影响系统性能 | 1. 优化算法减少硬件依赖<br>2. 提供硬件要求说明<br>3. 自适应性能调整 |
| 摄像头质量 | 影响测量准确性 | 1. 支持不同质量摄像头<br>2. 提供摄像头选择建议<br>3. 优化低质量摄像头处理 |
| 深度学习模型 | 影响皮肤分割准确性 | 1. 持续模型改进<br>2. 模型压缩和优化<br>3. 提供模型更新机制 |

### 10.4 成功因素

- **技术创新**：持续改进rPPG算法和信号处理技术
- **用户体验**：简洁直观的界面和流畅的操作体验
- **准确性**：不断提高心率测量的准确性和稳定性
- **可靠性**：系统在各种条件下的稳定运行
- **隐私保护**：确保用户数据安全和隐私保护
- **市场定位**：明确产品定位和目标用户群体
- **持续改进**：根据用户反馈不断优化产品

## 11. 项目规划

### 11.1 开发阶段

1. **需求分析与设计** (2周)
   - 详细需求分析
   - 系统架构设计
   - UI/UX设计

2. **核心功能开发** (6周)
   - 后端服务开发
   - 前端界面开发
   - 核心算法实现

3. **集成与测试** (3周)
   - 前后端集成
   - 功能测试
   - 性能测试

4. **优化与部署** (2周)
   - 性能优化
   - 兼容性测试
   - 部署准备

5. **发布与迭代** (1周)
   - 产品发布
   - 用户反馈收集
   - 计划后续迭代

### 11.2 关键里程碑

- **里程碑1**：核心算法实现完成，能够在实验室环境下准确测量心率
- **里程碑2**：前端界面开发完成，实现基本用户交互
- **里程碑3**：系统集成完成，能够端到端运行
- **里程碑4**：性能优化完成，达到实时处理要求
- **里程碑5**：产品正式发布，开始收集用户反馈

### 11.3 资源需求

- **开发团队**：前端开发、后端开发、算法开发、测试
- **硬件设备**：不同性能的测试设备、不同分辨率的摄像头
- **软件工具**：开发环境、测试工具、性能分析工具
- **数据资源**：多样化的测试数据、模型训练数据

## 12. 结论

本产品需求文档详细描述了心率识别系统的功能、非功能需求、用户接口设计、数据需求等内容。该系统通过创新的非接触式心率检测技术，为用户提供便捷、准确的心率监测解决方案。

系统的核心优势在于：
- **非接触式设计**：无需佩戴设备，使用方便
- **先进技术**：深度学习皮肤分割和高级信号处理
- **环境适应性**：在不同条件下保持稳定性能
- **用户友好**：直观简洁的界面设计

通过本产品，用户可以方便地监测自己的心率，了解自己的健康状况，为健康生活提供有力支持。同时，系统的模块化设计和可扩展性也为未来功能扩展和技术改进提供了良好基础。

本需求文档将作为产品开发、测试和验收的重要依据，确保最终产品能够满足用户需求和市场期望。